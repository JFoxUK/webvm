FROM --platform=i386 i386/debian:buster

# Avoid interactive prompts during package installation
ARG DEBIAN_FRONTEND=noninteractive

# Install required packages
RUN apt-get update \
 && apt-get -y upgrade \
 && apt-get install -y apt-utils zip unzip vim less binutils \
 && rm -rf /var/lib/apt/lists/*

# Set up user and puzzle environment
RUN useradd -M -d /game -s /bin/bash user \
 && echo "user:password" | chpasswd \
 && echo "root:password" | chpasswd \
 && mkdir -p /game/room1 /game/room2 \
 && mkdir -p /game/room3/corridor/roomA /game/room3/corridor/roomB \
 && mkdir -p /game/room3/tunnel/deeper/secret /game/room3/cave \
 && mkdir -p /game/room4 /game/room5 \
 && echo "You find yourself in a dark dungeon. The exit is locked." > /game/room1/README.txt \
 && echo "Perhaps something hidden holds the key..." >> /game/room1/README.txt \
 && echo "bronze" > /game/room1/.key_room2 \
 && echo "This parchment is too faded to read." > /game/room2/scroll1.txt \
 && echo "The scroll reads: 'silver' is the key." > /game/room2/scroll2.txt \
 && echo "An empty scroll, with nothing on it." > /game/room2/scroll3.txt \
 && echo "Just a dead end." > /game/room3/corridor/roomB/note.txt \
 && echo "gold" > /game/room3/tunnel/deeper/secret/treasure.txt \
 && echo "No key here." > /game/room3/cave/stone.txt \
 && echo "The inscription on the wall is incomprehensible:" > /game/room4/cipher.txt \
 && echo "cGxhdGludW0=" >> /game/room4/cipher.txt \
 && dd if=/dev/urandom bs=1 count=100 of=/game/room5/ancient_relic.bin \
 && echo -n "diamond" >> /game/room5/ancient_relic.bin \
 && echo "This mysterious file might contain human-readable clues." > /game/room5/README.txt \
 && echo "Maybe the 'strings' of this artifact will reveal its secret." >> /game/room5/README.txt \
 && cd /game \
 && zip -r -P bronze room2.zip room2 \
 && zip -r -P silver room3.zip room3 \
 && zip -r -P gold room4.zip room4 \
 && zip -r -P platinum room5.zip room5 \
 && rm -rf room2 room3 room4 room5 \
 && chown -R user:user /game

# Set working directory and environment
WORKDIR /home/user/
ENV HOME="/game" TERM="xterm" USER="user" SHELL="/bin/bash" EDITOR="vim" LANG="en_US.UTF-8" LC_ALL="C"

# Default command to start a bash login shell
CMD ["/bin/bash", "-l"]
